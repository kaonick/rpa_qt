<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modular Home Page</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" href="/imgs/favicon.png">
  <style>
    body { margin: 0; font-family: Arial, sans-serif; }
    .navi-block { display: flex; align-items: center; padding: 10px 20px; background: #f8f9fa; }
    .navi-block .logo-title { margin-right: auto; display: flex; align-items: center; cursor: pointer; }
    .navi-block .logo-title img { height: 32px; margin-right: 10px; }
    .navi-block .search-bar { flex-grow: 1; max-width: 400px; display: flex; margin: 0 20px; }
    .navi-block .search-bar input { flex: 1; }
    .navi-block .icon-btn { background: none; border: none; margin-left: 15px; position: relative; }
    .dropdown-panel { position: absolute; top: 100%; right: 0; background: white; border: 1px solid #ccc; padding: 10px; width: 250px; z-index: 1000; display: none; }
    .dropdown-panel.show { display: block; }
    .categoryList-block { background: #e9ecef; padding: 10px 20px; }
    .content-block { padding: 20px; }
  </style>
</head>
<body>
  <!-- Navi-block -->
  <div class="navi-block">
    <div class="logo-title" onclick="loadPage('home')">
      <img src="/imgs/logo.png" alt="Logo" />
      <strong>MySite</strong>
    </div>
    <div class="search-bar">
      <input id="searchInput" class="form-control" type="text" placeholder="Search..." onkeydown="if(event.key==='Enter') search()">
      <button class="btn btn-outline-secondary" onclick="search()">ğŸ”</button>
    </div>
    <button class="icon-btn" onclick="togglePanel('infoPanel')">ğŸ””
      <div id="infoPanel" class="dropdown-panel">
        <div id="infoList"></div>
      </div>
    </button>
    <button class="icon-btn" onclick="togglePanel('settingPanel')">âš™ï¸
      <div id="settingPanel" class="dropdown-panel">
<!--        <button onclick="loadPage('settings')">âš™ï¸ ç³»çµ±è¨­å®š</button>-->
          <div id="settingCard"></div>
      </div>
    </button>
    <button class="icon-btn" onclick="togglePanel('userPanel')">ğŸ‘¤
      <div id="userPanel" class="dropdown-panel">
<!--        <button onclick="loadPage('profile', { userId: 123 })">ğŸ‘¤ å€‹äººè³‡æ–™</button>-->
          <div id="userCard"></div>
      </div>
    </button>
  </div>

  <!-- Category List -->
  <div class="categoryList-block">
    <strong>åˆ†é¡ï¼š</strong> æ—…éŠ | ç¾é£Ÿ | ç§‘æŠ€ | æ™‚äº‹
  </div>

  <!-- Content Block -->
  <div class="content-block" id="content-block">
    <p>æ­¡è¿ä½¿ç”¨æœ¬ç«™ï¼Œè«‹å¾é¸å–®é¸æ“‡é é¢ã€‚</p>
  </div>

  <script>
    function togglePanel(id) {
      const panel = document.getElementById(id);
      const isOpen = panel.classList.contains('show');
      document.querySelectorAll('.dropdown-panel').forEach(p => p.classList.remove('show'));
      if (!isOpen) panel.classList.add('show');
    }

    function search() {
      const query = document.getElementById('searchInput').value.trim();
      if (!query) return;
      const results = Array.from({ length: 5 }, (_, i) => `<li>æœå°‹çµæœ ${i + 1}ï¼šèˆ‡ã€Œ${query}ã€æœ‰é—œçš„å…§å®¹</li>`).join('');
      document.getElementById('content-block').innerHTML = `
        <h5>æœå°‹ã€Œ${query}ã€çš„çµæœï¼š</h5>
        <ul>${results}</ul>
        <nav><button>ä¸Šä¸€é </button> <button>ä¸‹ä¸€é </button></nav>
      `;
    }

    // âœ… Load sub-page HTML + JS + CSS dynamically
    function loadPage(page, params = {}) {
      fetch(`pages/${page}.html`)
        .then(res => res.text())
        .then(html => {
          const container = document.getElementById("content-block");
          container.innerHTML = "";

          // æ¸…é™¤å­é  CSS
          document.querySelectorAll("[data-sub-style]").forEach(el => el.remove());

          const temp = document.createElement("div");
          temp.innerHTML = html;

          // æŠŠ style å’Œ link æ”¾é€² head
          temp.querySelectorAll("style, link[rel='stylesheet']").forEach(el => {
            el.dataset.subStyle = "true";
            document.head.appendChild(el.cloneNode(true));
          });

          // å‰©ä¸‹çš„å…§å®¹æ”¾é€² content-block
          temp.querySelectorAll(":not(style):not(link)").forEach(el => {
            container.appendChild(el);
          });

          // è¼‰å…¥ JSï¼Œä¸¦åŸ·è¡Œåˆå§‹åŒ– functionï¼ˆå¦‚æœ‰ï¼‰
          document.querySelectorAll("script[data-dynamic]").forEach(s => s.remove());
          const script = document.createElement("script");
          script.src = `js/${page}.js`;
          script.dataset.dynamic = "true";
          script.onload = () => {
            if (typeof window[`init_${page}`] === 'function') {
              window[`init_${page}`](params);
            }
          };
          document.body.appendChild(script);
        })
        .catch(err => {
          console.error(err);
          document.getElementById("content-block").innerHTML = "<p>ç„¡æ³•è¼‰å…¥é é¢</p>";
        });
    }

    // æ¨¡æ“¬é€šçŸ¥
    window.onload = () => {
      const infoList = document.getElementById('infoList');
      const notifications = [
        'ğŸ”” æ–°é€šçŸ¥ 1',
        'ğŸ”” æ–°é€šçŸ¥ 2',
        'ğŸ”” æ–°é€šçŸ¥ 3'
      ];
      infoList.innerHTML = notifications.map(msg =>
        `<div>${msg} <button onclick="this.parentElement.remove()">ğŸ—‘ï¸</button></div>`).join('');

      // setting card
      const settingCard = document.getElementById('settingCard');
      settingCard.innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
          <div><button onclick="loadPage('settings')">âš™ï¸ ç³»çµ±è¨­å®š</button></div>
          <div>é …ç›® 2</div>
          <div>é …ç›® 3</div>
          <div>é …ç›® 4</div>
          <div>é …ç›® 5</div>
          <div>é …ç›® 6</div>
        </div>
      `;

    };
  </script>
</body>
</html>
